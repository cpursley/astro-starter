---
import { Image } from "astro:assets";
import BaseLayout from "./BaseLayout.astro";
import TagList from "@/components/blog/TagList.astro";
import FormattedDate from "@/components/blog/FormattedDate.astro";
import TableOfContents from "@/components/blog/TableOfContents.astro";
import { useTranslations } from "@/i18n";

interface Frontmatter {
    author: string;
    description: string;
    image?: {
        url: string;
        alt: string;
    };
    pubDate: Date;
    tags: string[];
    title: string;
}

interface Props {
    frontmatter: Frontmatter;
    url: string;
    headings: {
        depth: number;
        text: string;
        slug: string;
    }[];
}

const { frontmatter, url, headings } = Astro.props;
const { author, description, image, pubDate, tags, title } = frontmatter;
const t = useTranslations();

const metaProps = {
    siteName: t("siteMetadata.title"),
    pageTitle: title,
    pageDescription: description,
    pageUrl: t("siteMetadata.url") + url,
};

const hasTableOfContents = headings && headings.length > 0;
---

<BaseLayout {...metaProps} pageTitle={title}>
    <div class="max-w-7xl mx-auto">
        <div class="flex flex-col lg:flex-row lg:space-x-8">
            <div class="lg:w-1/4">
                <nav class="mb-8">
                    <a href="/blog" class="text-blue-600 hover:text-blue-800">
                        &larr; Back to All Posts
                    </a>
                </nav>

                <div class="sticky top-8 space-y-8">
                    <div>
                        <h2 class="text-xl font-bold text-gray-900 mb-4">
                            Tags
                        </h2>
                        <TagList tags={tags} />
                    </div>

                    {
                        hasTableOfContents && (
                            <div>
                                <h2 class="text-xl font-bold text-gray-900 mb-4">
                                    Table Of Contents
                                </h2>
                                <div class="mb-8">
                                    <TableOfContents headings={headings} />
                                </div>
                            </div>
                        )
                    }
                </div>
            </div>

            <article class="lg:w-3/4">
                <header class="mb-8">
                    <h1 class="text-4xl font-bold text-gray-900 mb-4">
                        {title}
                    </h1>
                    <p class="text-lg text-gray-600 mb-4">
                        <em>{description}</em>
                    </p>
                    <div
                        class="flex items-center space-x-4 text-sm text-gray-500"
                    >
                        <span>By {author}</span>
                        <span>â€¢</span>
                        <FormattedDate date={pubDate} />
                    </div>
                </header>

                {
                    image && (
                        <Image
                            src={image.url}
                            alt={image.alt}
                            width={1200}
                            height={630}
                            format="webp"
                            class="w-full h-64 object-cover rounded-lg shadow-md mb-8"
                        />
                    )
                }

                <div
                    class="prose prose-lg max-w-none mb-8 prose-headings:text-gray-900 prose-a:text-blue-600 hover:prose-a:text-blue-800"
                >
                    <slot />
                </div>
            </article>
        </div>
    </div>
</BaseLayout>

<script>
    import { initSmoothScroll } from "../scripts/smoothScroll";
    initSmoothScroll('.toc a[href^="#"], .sidebar-nav a[href^="#"]');
</script>
